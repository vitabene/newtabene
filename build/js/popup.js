function slideLeftToElements(){var e=document.getElementById("elementSelect"),t=document.getElementById("styleSelect");e.className=e.className.replace(" slide-left"," slide-from-left"),setTimeout(function(){e.className=e.className.replace(" slide-from-left"," ")}),t.className=t.className.replace(" slide-from-right"," slide-right");var n=document.getElementsByClassName("active-controls")[0];n.className=n.className.replace(" active-controls"," ")}function slideRightToStyles(e){var t=document.getElementById("elementSelect"),n=document.getElementById("styleSelect");chrome.storage.sync.get("theme",function(t){var n=t.theme,a=Object.keys(n);a.indexOf(e)!==-1&&(styles=n[e]),cleanInputs(),loadToInputs(e)}),t.className+=" slide-left",n.className+=" slide-from-right"}function activateModule(e){chrome.storage.sync.get("activePlugins",function(t){var n=t.activePlugins;n.push(e),chrome.storage.sync.set({activePlugins:n},function(){})})}function deactivateModule(e){chrome.storage.sync.get("activePlugins",function(t){var n=t.activePlugins,a=n.indexOf(e);n.splice(a,1),chrome.storage.sync.set({activePlugins:n},function(){})})}function showActiveControls(e){for(var t=document.getElementById(e),n=document.getElementsByClassName("style-controls"),a=0;a<n.length;a++)n[a]!=t?n[a].className=n[a].className.replace("active-controls",""):n[a].className.indexOf("active-controls")!==-1?n[a].className=n[a].className.replace("active-controls",""):n[a].className=n[a].className+" active-controls"}function switchTabs(e){for(var t=document.getElementsByClassName("tab"),n=0;n<t.length;n++){var a=document.getElementById(t[n].id+"Content");t[n]!=e?(t[n].className=t[n].className.replace("active",""),a.className=a.className.replace("active","")):(t[n].className=t[n].className+" active",a.className=a.className+" active")}}function arrowMove(e){var t={},n=0;switch(e){case"arrowUp":t=document.getElementById("marginTop"),n=t.value,""==n?t.value="0":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)-20);break;case"arrowLeft":t=document.getElementById("marginLeft"),n=t.value,""==n?t.value="0":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)-20);break;case"arrowRight":t=document.getElementById("marginLeft"),n=t.value,""==n?t.value="20px":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)+20);break;case"arrowDown":t=document.getElementById("marginTop"),n=t.value,""==n?t.value="20px":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)+20)}t.value=n+"px",save()}function loadModuleContent(e){document.getElementById("selectedElementField");try{var t=new XMLHttpRequest;t.open("HEAD",e,!1),t.send(),404!=t.status&&(window.location=e)}catch(e){console.log(e);var n=document.getElementById("contentLink");n.children[0].style.background="red",setTimeout(function(){n.children[0].style.background="white"},200)}}function resetMargin(){var e=document.getElementById("position"),t=document.getElementById("top"),n=document.getElementById("bottom"),a=document.getElementById("left"),l=document.getElementById("right"),o=(document.getElementById("center"),document.getElementById("margin"));n.value="none",t.value="none",a.value="none",l.value="none",o.value="0";var s=document.getElementById("marginTop"),c=document.getElementById("marginLeft"),m=document.getElementById("marginBottom"),r=document.getElementById("marginRight");s.value="0",c.value="0",m.value="0",r.value="0",e.value="static",saveButton.click()}function stickTo(e,t){var n=document.getElementById("position"),a=document.getElementById("top"),l=document.getElementById("bottom"),o=document.getElementById("left"),s=document.getElementById("right"),c=(document.getElementById("center"),document.getElementById("margin"));n.value="absolute","top"==e&&(a.value=0,l.value="none"),"bottom"==e&&(l.value=0,a.value="none"),"left"==t&&(o.value=0,s.value="none"),"center"==t&&(o.value="48%"),"right"==t&&(s.value=0,o.value="none"),c.value=0,save()}var styles="",style="",theme="",element="",saveButton=document.getElementById("saveButton"),styleParent=document.getElementById("styleParent"),inputField=document.getElementById("inputField"),settingsParent=document.getElementById("settingsParent"),elementParent=document.getElementById("elementParent"),selectedElementField=document.getElementById("selectedElementField"),AVAILABLE_EXTENSIONS=["links","notes","linkNums","countdown","quote"],applyTheme=function(){chrome.storage.sync.get("theme",function(e){theme=e;var t=Object.keys(theme.theme),n="";for(rule in t){var a=theme.theme[t[rule]],l=Object.keys(a);n+="#newtab "+t[rule]+" {";for(var o=0;o<l.length;o++){var s=l[o]+":"+a[l[o]]+";";n+=s}n+="}"}chrome.storage.sync.set({activeTheme:{str:n}})})},applyThemeChange=function(e,t,n){chrome.storage.sync.get("theme",function(a){var l=a.theme;void 0===l[e]&&(l[e]={}),void 0===l[e][t]&&(l[e][t]=""),l[e][t]=n,chrome.storage.sync.set({theme:l},function(){applyTheme()})})},cleanInputs=function(){for(var e=document.getElementsByClassName("style-input"),t=0;t<e.length;t++){var n=e[t];n.value=""}},loadToInputs=function(e){if(void 0!=styles){var t=document.getElementsByClassName("style-input"),n=[];for(o=0;o<t.length;o++){var a=t[o];n.push(a.name)}for(var l=document.styleSheets,o=0;o<l.length;o++)for(var s=l[o].cssRules,c=0;c<s.length;c++){var m=s[c];if(m.selectorText=="#newtab "+e)for(var r=0;r<n.length;r++){var i=m.style[n[r]];if(""!=i){var a=t[r];a.value=i}}}for(o=0;o<t.length;o++){var a=t[o],m=a.name;void 0!=styles[m]&&(a.value=styles[m]),""==a.value&&(a.placeholder="not set")}}};window.onload=function(){chrome.storage.sync.get("activePlugins",function(e){for(var t=e.activePlugins,n=0;n<AVAILABLE_EXTENSIONS.length;n++){var a=AVAILABLE_EXTENSIONS[n],l=document.createElement("li"),o=document.createElement("span"),s=document.createElement("input");l.className="element",l.id="."+a,o.innerHTML=a,o.dataset.plugin=a,s.type="checkbox",t.indexOf(a)!==-1&&(s.checked=!0),l.appendChild(o),l.appendChild(s),elementParent.appendChild(l)}})};var save=function(){chrome.storage.sync.get("theme",function(e){for(var t=e.theme,n=document.getElementsByClassName("style-input"),a=0;a<n.length;a++){var l=n[a],o=l.name;if(""!=l.value){styles[o]=l.value;var s="."+selectedElementField.value;void 0===t[s]&&(t[s]={}),void 0===t[s][o]&&(t[s][o]=""),t[s][o]=l.value,"background-color"!=o&&"color"!=o||l.value.indexOf("#")===-1&&(t[s][o]="#"+l.value),"margin"==o&&("0"==l.value?(t[s]["margin-right"]=0,t[s]["margin-left"]=0):"auto"==l.value&&(t[s]["margin-right"]="auto",t[s]["margin-left"]="auto"))}}chrome.storage.sync.set({theme:t},function(){applyTheme()})})};document.addEventListener("click",function(e){var t=e.target,n=e.target.id;if("element"==t.parentNode.className&&"checkbox"!=t.type)t=t.parentNode,n=t.id;else if("checkbox"==t.type){var a=t.previousElementSibling;if(void 0==a.dataset.plugin)return;var l=a.dataset.plugin;t.checked?activateModule(l):deactivateModule(l)}if(t.className.indexOf("element")!==-1?(selectedElementField.value=n.replace(".",""),slideRightToStyles(n)):t.className.indexOf("tab")!==-1?switchTabs(t):t.className.indexOf("arrow")!==-1&&arrowMove(t.id),"style"==t.className){var o=t.dataset.ctrls;showActiveControls(o)}if("saveButton"==n?save():"elementBackButton"==n&&slideLeftToElements(),"resetMarginButton"==t.id&&resetMargin(),"contentLink"==t.id||"contentLink"==t.parentNode.id){e.preventDefault();var s="./"+selectedElementField.value+".html";loadModuleContent(s)}if(""!=t.dataset.stick){var c=t.parentNode;stickTo(c.dataset.row,t.dataset.stick)}},!1),document.onkeydown=function(e){13==e.keyCode&&save()};