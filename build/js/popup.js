function slideLeftToElements(){var e=document.getElementById("elementSelect"),t=document.getElementById("styleSelect");e.className=e.className.replace(" slide-left"," slide-from-left"),setTimeout(function(){e.className=e.className.replace(" slide-from-left"," ")}),t.className=t.className.replace(" slide-from-right"," slide-right");var n=document.getElementsByClassName("style-controls")[0];n.style.display="none"}function slideRightToStyles(e){var t=document.getElementById("elementSelect"),n=document.getElementById("styleSelect");chrome.storage.sync.get("theme",function(t){var n=t.theme,l=Object.keys(n);l.indexOf(e)!==-1&&(styles=n[e]),cleanInputs(),loadToInputs(e)}),t.className+=" slide-left",n.className+=" slide-from-right",aC=document.getElementsByClassName("style-controls")[0],aC.style.display="none"}function activateModule(e){chrome.storage.sync.get("activePlugins",function(t){var n=t.activePlugins;n.push(e),chrome.storage.sync.set({activePlugins:n},function(){})})}function deactivateModule(e){chrome.storage.sync.get("activePlugins",function(t){var n=t.activePlugins,l=n.indexOf(e);n.splice(l,1),chrome.storage.sync.set({activePlugins:n},function(){})})}function showControls(){var e=document.getElementsByClassName("style-controls")[0];e.style.display="block"}function arrowMove(e){var t={},n=0;switch(e){case"arrowUp":t=document.getElementById("marginTop"),n=t.value,""==n?t.value="0":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)-20);break;case"arrowLeft":t=document.getElementById("marginLeft"),n=t.value,""==n?t.value="0":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)-20);break;case"arrowRight":t=document.getElementById("marginLeft"),n=t.value,""==n?t.value="20px":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)+20);break;case"arrowDown":t=document.getElementById("marginTop"),n=t.value,""==n?t.value="20px":(n=n.replace(/\r?\n|\%|\r/g,""),n=parseInt(n)+20)}t.value=n+"px",save()}function loadModuleContent(e){document.getElementById("selectedElementField");try{var t=new XMLHttpRequest;t.open("HEAD",e,!1),t.send(),404!=t.status&&(window.location=e)}catch(e){console.log(e);var n=document.getElementById("contentLink");n.children[0].style.background="red",setTimeout(function(){n.children[0].style.background="white"},200)}}function resetMargin(){var e=document.getElementById("position"),t=document.getElementById("top"),n=document.getElementById("bottom"),l=document.getElementById("left"),a=document.getElementById("right"),o=(document.getElementById("center"),document.getElementById("margin"));n.value="none",t.value="none",l.value="none",a.value="none",o.value="0";var s=document.getElementById("marginTop"),c=document.getElementById("marginLeft"),m=document.getElementById("marginBottom"),r=document.getElementById("marginRight");s.value="0",c.value="0",m.value="0",r.value="0",e.value="static",saveButton.click()}function stickTo(e,t){var n=document.getElementById("position"),l=document.getElementById("top"),a=document.getElementById("bottom"),o=document.getElementById("left"),s=document.getElementById("right"),c=(document.getElementById("center"),document.getElementById("margin"));n.value="absolute","top"==e&&(l.value=0,a.value="none"),"bottom"==e&&(a.value=0,l.value="none"),"left"==t&&(o.value=0,s.value="none"),"center"==t&&(o.value="48%"),"right"==t&&(s.value=0,o.value="none"),c.value=0,save()}var styles="",style="",theme="",element="",saveButton=document.getElementById("saveButton"),styleParent=document.getElementById("styleParent"),inputField=document.getElementById("inputField"),settingsParent=document.getElementById("settingsParent"),elementParent=document.getElementById("elementParent"),selectedElementField=document.getElementById("selectedElementField"),AVAILABLE_EXTENSIONS=["links","notes","linkNums","countdown","quote"],applyTheme=function(){chrome.storage.sync.get("theme",function(e){theme=e;var t=Object.keys(theme.theme),n="";for(rule in t){var l=theme.theme[t[rule]],a=Object.keys(l);n+="#newtab "+t[rule]+" {";for(var o=0;o<a.length;o++){var s=a[o]+":"+l[a[o]]+";";n+=s}n+="}"}chrome.storage.sync.set({activeTheme:{str:n}})})},applyThemeChange=function(e,t,n){chrome.storage.sync.get("theme",function(l){var a=l.theme;void 0===a[e]&&(a[e]={}),void 0===a[e][t]&&(a[e][t]=""),a[e][t]=n,chrome.storage.sync.set({theme:a},function(){applyTheme()})})},cleanInputs=function(){for(var e=document.getElementsByClassName("style-input"),t=0;t<e.length;t++){var n=e[t];n.value=""}},loadToInputs=function(e){if(void 0!=styles){var t=document.getElementsByClassName("style-input"),n=[];for(o=0;o<t.length;o++){var l=t[o];n.push(l.name)}for(var a=document.styleSheets,o=0;o<a.length;o++)for(var s=a[o].cssRules,c=0;c<s.length;c++){var m=s[c];if(m.selectorText=="#newtab "+e)for(var r=0;r<n.length;r++){var i=m.style[n[r]];if(""!=i){var l=t[r];l.value=i}}}for(o=0;o<t.length;o++){var l=t[o],m=l.name;void 0!=styles[m]&&(l.value=styles[m]),""==l.value&&(l.placeholder="not set")}}};window.onload=function(){chrome.storage.sync.get("activePlugins",function(e){for(var t=e.activePlugins,n=0;n<AVAILABLE_EXTENSIONS.length;n++){var l=AVAILABLE_EXTENSIONS[n],a=document.createElement("li"),o=document.createElement("span"),s=document.createElement("input");a.className="element",a.id="."+l,o.innerHTML=l,o.dataset.plugin=l,s.type="checkbox",t.indexOf(l)!==-1&&(s.checked=!0),a.appendChild(o),a.appendChild(s),elementParent.appendChild(a)}})};var save=function(){chrome.storage.sync.get("theme",function(e){for(var t=e.theme,n=document.getElementsByClassName("style-input"),l=0;l<n.length;l++){var a=n[l],o=a.name;if(""!=a.value){styles[o]=a.value;var s="."+selectedElementField.value;void 0===t[s]&&(t[s]={}),void 0===t[s][o]&&(t[s][o]=""),t[s][o]=a.value,"margin"==o&&("0"==a.value?(t[s]["margin-right"]=0,t[s]["margin-left"]=0):"auto"==a.value&&(t[s]["margin-right"]="auto",t[s]["margin-left"]="auto"))}}chrome.storage.sync.set({theme:t},function(){applyTheme()})})};document.addEventListener("click",function(e){var t=e.target,n=e.target.id;if("element"==t.parentNode.className&&"checkbox"!=t.type)t=t.parentNode,n=t.id;else if("checkbox"==t.type){var l=t.previousElementSibling;if(void 0==l.dataset.plugin)return;var a=l.dataset.plugin;t.checked?activateModule(a):deactivateModule(a)}if(t.className.indexOf("element")!==-1?(selectedElementField.value=n.replace(".",""),slideRightToStyles(n),showControls()):t.className.indexOf("arrow")!==-1&&arrowMove(t.id),"saveButton"==n?save():"elementBackButton"==n&&slideLeftToElements(),"resetMarginButton"==t.id&&resetMargin(),"contentLink"==t.id||"contentLink"==t.parentNode.id){e.preventDefault();var o="./"+selectedElementField.value+".html";loadModuleContent(o)}},!1),document.onkeydown=function(e){13==e.keyCode&&save()};